<h2>Listado de Modelos</h2>

<div>
  <div class="row align-items-end mb-3">
    <div class="col-sm-4">
      <div [formGroup]="vehicleListadoForm">
        <label for="vin" class="form-label">vin</label>
        <input type="text" class="form-control" formControlName="vin" id="vin" />
      </div>
    </div>

    <div class="col-sm-4">
      <div [formGroup]="vehicleListadoForm">
        <label for="marca" class="form-label">Marca</label>
        <select class="form-control" formControlName="marca" id="marca">
          <option value="">Seleccione una marca</option>
          @for (brand of brands; track brand.idMarca) {
          <option [value]="brand.idMarca">{{ brand.nombre }}</option>
          }
        </select>
      </div>
    </div>

      <div class="col-sm-4">
      <div [formGroup]="vehicleListadoForm">
        <label for="modelo" class="form-label">Modelo</label>
        <select class="form-control" formControlName="modelo" id="modelo">
          <option value="">Seleccione un modelo</option>
          @for (modelo of models; track modelo.idModelo) {
          <option [value]="modelo.idModelo">{{ modelo.nombre }}</option>
          }
        </select>
      </div>
    </div>
    </div>
    
   <div class="row mb-3">
    <div class="col-sm-12 d-flex gap-2">
      <button type="button" class="btn btn-primary" (click)="buscar()">
        <i class="bi bi-search me-2"></i>
        Buscar
      </button>

      <button type="button" class="btn btn-secondary" (click)="limpiar()">
        <i class="bi bi-x-circle me-2"></i>
        Limpiar
      </button>

      <button type="button" class="btn btn-success" (click)="nuevo()">
        <i class="bi bi-file-plus me-2"></i>
        Nuevo
      </button>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <table class="table">
        <thead>
          <tr>
            <th class="col-id">Id</th>
            <th class="col-vin">vin</th>
            <th class="col-anio">Año</th>
            <th class="col-combustible">Combustible</th>
            <th class="col-marca">Marca</th>
            <th class="col-modelo">Modelo</th>
            <th class="col-estado">Estado</th>

            <th class="col-acciones text-center">Acciones</th>
          </tr>
        </thead>

        <tbody>
          @for (vehicle of vehicles; track vehicle.idVehiculo) {
          <tr>
            <th>{{ vehicle.idVehiculo }}</th>
            <td>{{ vehicle.vin }}</td>
            <td>{{ vehicle.anio }}</td>
            <td>{{ vehicle.tipoCombustible }}</td>
            <td>{{ vehicle.marcaNombre }}</td>
            <td>{{ vehicle.modeloNombre }}</td>
            <td>{{ vehicle.estadoVehiculo }}</td>


            <td class="col-acciones">
              <div class="d-flex justify-content-end gap-2">
                <button 
                  type="button" 
                  class="btn btn-outline-info btn-sm"  
                  (click)="openModal(template, vehicle)"                 
                >
                  <i class="bi bi-folder2-open me-2"></i>Info
                </button>

                <button type="button" class="btn btn-outline-success btn-sm" (click)="edit(vehicle)">
                  <i class="bi bi-pen me-1"></i> Modificar
                </button>

                <button type="button" class="btn btn-outline-danger me-2" (click)="delete(vehicle)">
                  <i class="bi bi-trash3 me-2"></i> Eliminar
                </button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>

      @if (totalElements > 0) {
      <nav class="mt-3 pagination-container">
        <ul class="pagination justify-content-center">
          <!-- Botón Anterior -->
          <li class="page-item" [class.disabled]="page === 0">
            <button class="page-link" (click)="changePage(page - 1)">Anterior</button>
          </li>

          @for (pageItem of [].constructor(totalPages); track $index) {
          <li class="page-item" [class.active]="$index === page">
            <button class="page-link" (click)="changePage($index)">
              {{ $index + 1 }}
            </button>
          </li>
          }

          <li class="page-item" [class.disabled]="page === totalPages - 1">
            <button class="page-link" (click)="changePage(page + 1)">Siguiente</button>
          </li>
        </ul>
      </nav>
      }
    </div>
  </div>
</div>

<ng-template #template>
  <div class="modal-header">
    <h4 class="modal-title">Información del Vehículo</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modalRef?.hide()">
    </button>
  </div>

  @if (vehicleSelected) {
    <div class="modal-body">
      <div class="card">
        <div class="card-header">
          {{ vehicleSelected.placa || 'Vehículo sin placa' }}
        </div>

        <div class="card-body">
          <p>
            <strong>ID Vehículo:</strong>
            {{ vehicleSelected.idVehiculo || 'No registrado' }}
          </p>

          <p>
            <strong>VIN:</strong>
            {{ vehicleSelected.vin || 'No registrado' }}
          </p>

          <p>
            <strong>Año:</strong>
            {{ vehicleSelected.anio || 'No registrado' }}
          </p>

          <p>
            <strong>Marca:</strong>
            {{ vehicleSelected.marcaNombre || 'No registrada' }}
          </p>

          <p>
            <strong>Modelo:</strong>
            {{ vehicleSelected.modeloNombre || 'No registrado' }}
          </p>

          <p>
            <strong>Color:</strong>
            {{ vehicleSelected.color || 'No registrado' }}
          </p>

          <p>
            <strong>Kilometraje:</strong>
            {{ vehicleSelected.kilometraje || '0' }} km
          </p>

          <p>
            <strong>Tipo de Combustible:</strong>
            {{ vehicleSelected.tipoCombustible || 'No registrado' }}
          </p>

          <p>
            <strong>Transmisión:</strong>
            {{ vehicleSelected.transmision || 'No registrada' }}
          </p>

          <p>
            <strong>Estado:</strong>
            {{ vehicleSelected.estadoVehiculo || 'No registrado' }}
          </p>

          <p>
            <strong>Precio:</strong>
            S/ {{ vehicleSelected.precio || '0.00' }}
          </p>
        </div>
      </div>

      <div class="text-end mt-3">
        <button class="btn btn-primary" (click)="modalRef?.hide()">
          Cerrar
        </button>
      </div>
    </div>
  }
</ng-template>
